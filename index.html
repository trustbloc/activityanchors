<!DOCTYPE html>
<html>
  <head>
    <title>Activity Anchors v0.1</title>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c' async class='remove'></script>
    <script class='remove'>
      var respecConfig = {
        specStatus: "unofficial",
        subtitle: "An anchoring system for a fediverse of interconnected nodes and witnesses",
        editors: [{
          name: "Troy Ronda", url: "https://www.linkedin.com/in/troyronda/",
          company: "SecureKey", companyURL: "https://securekey.com/"
        }],
        github: "https://github.com/trustbloc/activityanchors",
        localBiblio: {
          "LDPROOF": {
            title: "Linked Data Proofs 1.0",
            href: "https://w3c-ccg.github.io/ld-proofs/",
            publisher: "W3C CCG",
            status: "Draft Community Group Report"
          },
          "HASHLINK": {
            title: "Cryptographic Hyperlinks",
            date: "May 2021",
            href: "https://tools.ietf.org/html/draft-sporny-hashlink-07",
            authors: [
              "M. Sporny",
              "L. Rosenthol"
            ],
            status: "Internet-Draft",
            publisher: "IETF"
          },
          "MULTIHASH": {
            title: "The Multihash Data Format",
            date: "February 2021",
            href: "https://tools.ietf.org/html/draft-multiformats-multihash-02",
            authors: [
              "J. Benet",
              "M. Sporny"
            ],
            status: "Internet-Draft",
            publisher: "IETF"
          },
          "MULTIBASE": {
            title: "The Multibase Data Format",
            date: "February 2021",
            href: "https://tools.ietf.org/html/draft-multiformats-multibase-03",
            authors: [
              "J. Benet",
              "M. Sporny"
            ],
            status: "Internet-Draft",
            publisher: "IETF"
          }          
        }
      };
    </script>
  </head>
  <body>
    <section id='abstract'>
      <p>
        Activity Anchors are based on a federated and replicated
        <a href="https://www.w3.org/TR/did-core/#dfn-verifiable-data-registry">Verifiable Data Registry</a> (VDR).
        The decentralized network consists of Activity Anchor Servers that write, monitor, witness, and propagate batches of document operations.
        The batches form a graph that is propagated and replicated between the servers as content-addressable objects.
        These content-addressable objects can be located via both domain and distributed hash table (DHT) mechanisms.
        Each Activity Anchor witness server observes a subset of batches in the graph and includes them in their ledgers (as append-only Merkle Tree logs).
        The servers coordinate by propagating batches of document operations and by monitoring the applicable witness servers' ledgers.
        The Activity Anchor servers form a decentralized network without reliance on a common blockchain for coordination.
      </p>

      <p>
        This document specifies a data model and rules for representing a graph of batches, 
        the anchor server API,
        an [[[ACTIVITYSTREAMS-CORE]]] vocabulary and an [[[ACTIVITYPUB]]] profile for propagating batches,
        and a [[[RFC7033]]] profile for discovering endpoints.
      </p>
    </section>
    <section id='sotd'>
      <p>
      </p>
    </section>
    
    <section class="informative">
        <h2>Introduction</h2>

        <p>
          Our motivation for Activity Anchors is to enable many independent organizations to create <a href="https://www.w3.org/TR/did-core/#dfn-verifiable-data-registry">
          Verifiable Data Registries</a> (VDRs) that can become connected over time.
          In designing Activity Anchors, we have the goal to enable these VDRs to interconnect into a decentralized network without the need to choose a common public
          blockchain or to rely on special-purpose consortiums to form (and remain in operation).
          Activity Anchors enables a federated, replicated and scalable VDR based on a decentralized network for propagating, witnessing and replicating changes to documents.
        </p>

    </section>

    <section class="normative">
        <h2>Server-to-Server APIs</h2>

        <p>
          An Activity Anchor Server exposes APIs for propagation, content-addressable storage, discovery, and witnessing.
        </p>

        <section class="normative">
          <h3>Vocabulary</h3>

          <section class="normative" id="anchorevent">
            <h4>AnchorEvent</h4>

            <p>
              An operation batch is represented as an <i>AnchorEvent</i>.
              Hashlinks [[HASHLINK]] are used to link objects to the AnchorEvent.
              The AnchorEvent object contains an <i>attachment</i> property that represent objects related to the AnchorEvent.
            </p>

            <p>
              The <i>AnchorObject</i> represents general content that is related to the AnchorEvent.
              The <i>url</i> property identifies the content.
              The <i>contentObject</i> property enables the content to be embedded within the <i>AnchorObject</i> as JSON.
            </p>

            <p>
              The <i>AnchorIndex</i> object represents content that is intended to be consumed by an appropriate processor.
              The <i>generator</i> property enables the appropriate processor (and version) to be determined.
              The <i>url</i> property identifies the content.
              The <i>metadata</i> property identifies objects that the processor uses to consume the content.
              The primary purpose of <i>metadata</i> is to map the referenced content into the anchoring system.
              As an example, a processor can associate identifiers (within the referenced content) to prior anchor events.
            </p>

            <p>
              Hashlinks may refer to the <i>contentObject</i> within an <i>AnchorObject</i>.
              Prior to creating the hash in the Hashlink, the contents of the <i>contentObject</i> MUST be canoncialized using the JSON Canonicalization Scheme (JCS) [[RFC8785]].
              The Hashlink refers to the canonicalized contents of the <i>contentObject</i>.
            </p>

            <pre class="example highlight" title="AnchorEvent with attachments">
              {
                "@context": "https://w3id.org/activityanchors/v1",
                "type": "AnchorEvent",
                "attributedTo": "https://example.domain1.com/services/example",
                "index": "hl:uEiCF5Mr8n7NPsAGenkNIoY0tJtnqDUWMk_XdYpgOm5yNnA",
                "parent": "hl:uEiAL-T2TdNkqL5gRIX8BZvrXESPOzoIYy98YUBxc5xAG0w:uoQ-BeEJpcGZzOi8vYmFma3JlaWFsN2U2emc1Z3pmaXh6cWVqYnA0YXduNnd4Y2VyNDV0dWNkZGY1NmdjcWRyb29vZWFnMm0",
                "published": "2021-10-29T18:06:34.554883376Z",
                "url": "hl:uEiAyUitoMn-ujmlFC6DBW2AlWabxGfVpGw0b3ymcqwzSHQ:uoQ-BeEJpcGZzOi8vYmFma3JlaWJza2l2d3FtdDd2Mmhnc3JpbHVkYXZ3eWJmbGd0cGNncHZuZW5xMmc2N2Znb2t3ZGdzZHU",
                "attachment": [
                  {
                    "contentObject": {
                      "properties": {
                        "https://w3id.org/activityanchors#generator": "https://example.com/spec#v1",
                        "https://w3id.org/activityanchors#resources": [
                          {
                            "id": "did:example:uEiAL-T2TdNkqL5gRIX8BZvrXESPOzoIYy98YUBxc5xAG0w:EiCIZ0W-fdodoK39vGPl1rxDJTinYN2kTBhddS9xnen-Aw",
                            "previousAnchor": "hl:uEiAL-T2TdNkqL5gRIX8BZvrXESPOzoIYy98YUBxc5xAG0w"
                          }
                        ]
                      },
                      "subject": "hl:uEiA30C_KU_wogvUhJKLUA8bXHqSM_75X1QZQN3z_4VacXQ:uoQ-BeEJpcGZzOi8vYmFma3JlaWJ4MmF4NHV1NzRmY2Jwa2lqZXVsa2Focnd4ZDJzaXo3NTZrN2txbXVieHB0NzZjdnU0bHU"
                    },
                    "generator": "https://example.com/spec#v1",
                    "tag": [
                      {
                        "href": "hl:uEiAdjYmJQEhKreYkikrMUfyFPVyEKLmfoHWmKhebWyNpUw",
                        "rel": [
                          "witness"
                        ],
                        "type": "Link"
                      }
                    ],
                    "type": "AnchorObject",
                    "url": "hl:uEiCF5Mr8n7NPsAGenkNIoY0tJtnqDUWMk_XdYpgOm5yNnA"
                  },
                  {
                    "contentObject": {
                      "@context": [
                        "https://www.w3.org/2018/credentials/v1",
                        "https://w3id.org/security/suites/jws-2020/v1"
                      ],
                      "credentialSubject": "hl:uEiCF5Mr8n7NPsAGenkNIoY0tJtnqDUWMk_XdYpgOm5yNnA",
                      "id": "https://example2.domain1.com/vc/1da2c6c8-6ef4-4860-be92-45cc88c3614b",
                      "issuanceDate": "2021-10-29T18:06:34.556862797Z",
                      "issuer": "https://example2.domain1.com",
                      "proof": [
                        {
                          "created": "2021-10-29T18:06:34.566Z",
                          "domain": "http://example.domain1.com",
                          "jws": "eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..XRafN3mZOI-NuEtYWVSxNLCRd-tMg3nOgyHW4ke8P8YoGhu2O5h8t7yMj2lRcpElA1oE7zn_u3_nM6W1TvsXCA",
                          "proofPurpose": "assertionMethod",
                          "type": "Ed25519Signature2018",
                          "verificationMethod": "did:web:example.domain1.com#example"
                        },
                        {
                          "created": "2021-10-29T18:06:34.723037523Z",
                          "domain": "https://example.domain2.com",
                          "jws": "eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..Hz-J6lY5Ombe-pj6qv5SVhou_O-zqsBkmtoYEs76wyrZef4YoBm9B0jfYn1o0Iu1cm1g4ent_5xq7SMp5LlUAQ",
                          "proofPurpose": "assertionMethod",
                          "type": "Ed25519Signature2018",
                          "verificationMethod": "did:web:example.domain2.com#example2key"
                        }
                      ],
                      "type": "VerifiableCredential"
                    },
                    "generator": "https://example.com/spec#v1",
                    "type": "AnchorObject",
                    "url": "hl:uEiAdjYmJQEhKreYkikrMUfyFPVyEKLmfoHWmKhebWyNpUw"
                  }
                ]
              }
            </pre>

            <pre class="example highlight" title="Cryptographic Hyperlink Example">
              hl:uEiAsiwjaXOYDmOHxmvDl3Mx0TfJ0uCar5YXqumjFJUNIBg:uoQ-CeEdodHRwczovL2V4YW1wbGUuY29tL2Nhcy91RWlBc2l3amFYT1lEbU9IeG12RGwzTXgwVGZKMHVDYXI1WVhxdW1qRkpVTklCZ3hCaXBmczovL2JhZmtyZWlibXJtZW51eGhnYW9tb2Q0bTI2ZHM1enRkdWp4emhqb2JndnBzeWwydjJuZGNza3EyaWF5",
            </pre>

            <p>
            The example hashlink includes links to `https://example.com/cas/uEiAsiwjaXOYDmOHxmvDl3Mx0TfJ0uCar5YXqumjFJUNIBg` and `ipfs://bafkreibmrmenuxhgaomod4m26ds5ztdujxzhjobgvpsyl2v2ndcskq2iay` to demonstrate that multiple sources and protocols can be used for each object.
            </p>

            <p class="issue" title="Describe vocabulary">
              TODO: Complete the description of anchor events.
            </p>

          </section>

          <section class="normative" id="anchorcredential">
            <h4>Witnessed Event</h4>

            <p>
              A witnessed operation batch is represented as an attached <i>VerifiableCredential</i>.
              The <i>credentialSubject</i> contains the hash of the witnessed object.
            </p>

            <pre class="example highlight" title="Witness attachment">
              {
                "contentObject": {
                  "@context": [
                    "https://www.w3.org/2018/credentials/v1",
                    "https://w3id.org/security/suites/jws-2020/v1"
                  ],
                  "credentialSubject": "hl:uEiCF5Mr8n7NPsAGenkNIoY0tJtnqDUWMk_XdYpgOm5yNnA",
                  "id": "https://example2.domain1.com/vc/1da2c6c8-6ef4-4860-be92-45cc88c3614b",
                  "issuanceDate": "2021-10-29T18:06:34.556862797Z",
                  "issuer": "https://example2.domain1.com",
                  "proof": [
                    {
                      "created": "2021-10-29T18:06:34.566Z",
                      "domain": "http://example.domain1.com",
                      "jws": "eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..XRafN3mZOI-NuEtYWVSxNLCRd-tMg3nOgyHW4ke8P8YoGhu2O5h8t7yMj2lRcpElA1oE7zn_u3_nM6W1TvsXCA",
                      "proofPurpose": "assertionMethod",
                      "type": "Ed25519Signature2018",
                      "verificationMethod": "did:web:example.domain1.com#example"
                    },
                    {
                      "created": "2021-10-29T18:06:34.723037523Z",
                      "domain": "https://example.domain2.com",
                      "jws": "eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..Hz-J6lY5Ombe-pj6qv5SVhou_O-zqsBkmtoYEs76wyrZef4YoBm9B0jfYn1o0Iu1cm1g4ent_5xq7SMp5LlUAQ",
                      "proofPurpose": "assertionMethod",
                      "type": "Ed25519Signature2018",
                      "verificationMethod": "did:web:example.domain2.com#example2key"
                    }
                  ],
                  "type": "VerifiableCredential"
                },
                "generator": "https://example.com/spec#v1",
                "type": "AnchorObject",
                "url": "hl:uEiAdjYmJQEhKreYkikrMUfyFPVyEKLmfoHWmKhebWyNpUw"
              }
            </pre>

            The anchor is embedded within an Activity during propagation flows.
            The Activity includes information about the CAS.

            <pre class="example highlight" title="Anchor as an AnchorCredential wrapped in a Create Activity">
              {
                "@context": [
                  "https://www.w3.org/ns/activitystreams",
                  "https://w3id.org/activityanchors/v1"
                ],
                "actor": "https://example.domain1.com/services/example",
                "id": "https://example.domain1.com/services/example/activities/5310cde8-ce3b-4c67-b83b-5e1ab7afa7b4",
                "object": {
                  "@context": "https://w3id.org/activityanchors/v1",
                  "attachment": [
                    {
                      "contentObject": {
                        "properties": {
                          "https://w3id.org/activityanchors#generator": "https://example.com/spec#v1",
                          "https://w3id.org/activityanchors#resources": [
                            {
                              "id": "did:example:uEiA7nHXweEsQJ38osrh4sIDC6qWtFBi59KH9mPVieqhZ2A:EiAg41m285JcxHNd2lBuQwtxFPHuZbupNFLTj-XaRKPXzQ",
                              "previousAnchor": "hl:uEiA7nHXweEsQJ38osrh4sIDC6qWtFBi59KH9mPVieqhZ2A"
                            }
                          ]
                        },
                        "subject": "hl:uEiBk_3IacFfHbtWWeGoTiWNgGmSu-alJK8ygi55flvC-6g:uoQ-CeEtodHRwczovL29yYi5kb21haW4xLmNvbS9jYXMvdUVpQmtfM0lhY0ZmSGJ0V1dlR29UaVdOZ0dtU3UtYWxKSzh5Z2k1NWZsdkMtNmd4QmlwZnM6Ly9iYWZrcmVpZGU3NXpidTRjeHk1eG5sZnR5bmlqeXN5M2FkanNrNTZuampldjR6aWVsdHpwem40ZjY1aQ"
                      },
                      "generator": "https://example.com/spec#v1",
                      "tag": [
                        {
                          "href": "hl:uEiCQP9wIPE0EmK9bJzCNtGb_8uOO-fdQfslau1aXP4DL_Q",
                          "rel": [
                            "witness"
                          ],
                          "type": "Link"
                        }
                      ],
                      "type": "AnchorObject",
                      "url": "hl:uEiCpDgdsT7zHRambMrQAX8iKiyBnlNryJoXoFRw6XUpsjQ"
                    },
                    {
                      "contentObject": {
                        "@context": [
                          "https://www.w3.org/2018/credentials/v1",
                          "https://w3id.org/security/suites/jws-2020/v1"
                        ],
                        "credentialSubject": "hl:uEiCpDgdsT7zHRambMrQAX8iKiyBnlNryJoXoFRw6XUpsjQ",
                        "id": "https://example2.domain1.com/vc/2e8bde2b-28d3-4bae-bb53-7b0829b2e4bc",
                        "issuanceDate": "2021-11-12T19:35:18.0020806Z",
                        "issuer": "https://example2.domain1.com",
                        "proof": [
                          {
                            "created": "2021-11-12T19:35:18.009Z",
                            "domain": "http://example.vct:8077/maple2020",
                            "jws": "eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..f1_1LbWyMPEP06F3B3fERyflDrQK4QGWmLvaSOlgYIoITytEcARDiE4htVwmJz1iXDWZGNwl1ic9SVyDxw6UAg",
                            "proofPurpose": "assertionMethod",
                            "type": "Ed25519Signature2018",
                            "verificationMethod": "did:web:example.domain1.com#example1key"
                          },
                          {
                            "created": "2021-11-12T19:35:18.1946195Z",
                            "domain": "https://example.domain2.com",
                            "jws": "eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..iIYVqDs8qdaHomub8J_X7yGLcdyrGuq2LGpz6z2dZYOI4mfTViDzYIi6vt4e5p-SeMgChqyhMZeGTKNOuYOXCg",
                            "proofPurpose": "assertionMethod",
                            "type": "Ed25519Signature2018",
                            "verificationMethod": "did:web:example.domain2.com#example2key"
                          }
                        ],
                        "type": "VerifiableCredential"
                      },
                      "generator": "https://example.com/spec#v1",
                      "type": "AnchorObject",
                      "url": "hl:uEiCQP9wIPE0EmK9bJzCNtGb_8uOO-fdQfslau1aXP4DL_Q"
                    }
                  ],
                  "attributedTo": "https://example.domain1.com/services/example",
                  "index": "hl:uEiCpDgdsT7zHRambMrQAX8iKiyBnlNryJoXoFRw6XUpsjQ",
                  "parent": "hl:uEiA7nHXweEsQJ38osrh4sIDC6qWtFBi59KH9mPVieqhZ2A:uoQ-CeEtodHRwczovL29yYi5kb21haW4xLmNvbS9jYXMvdUVpQTduSFh3ZUVzUUozOG9zcmg0c0lEQzZxV3RGQmk1OUtIOW1QVmllcWhaMkF4QmlwZnM6Ly9iYWZrcmVpYjN0cjI3YTZjbGNhdHg2a2ZzeGI0bGJhZ2M1a3MyMmZheXhoMmtkN215NnZyaHZrY3ozYQ",
                  "published": "2021-11-12T19:35:18.0017151Z",
                  "type": "AnchorEvent",
                  "url": "hl:uEiB14RklxzqmoiOpQ7KAoQQukw4rIjXhycqZbeqNBq8ecg:uoQ-CeEtodHRwczovL29yYi5kb21haW4xLmNvbS9jYXMvdUVpQjE0UmtseHpxbW9pT3BRN0tBb1FRdWt3NHJJalhoeWNxWmJlcU5CcThlY2d4QmlwZnM6Ly9iYWZrcmVpZHY0ZW1zbHJ6MnUycmNoa2tkd2tha2NiYm9zbWhjd2lydjRoZTR2Z2xuNWtncW5seTZvaQ"
                },
                "published": "2021-11-12T19:35:18.5675526Z",
                "to": [
                  "https://example.domain1.com/services/example/followers",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "type": "Create"
              }
            </pre>

          </section>

        </section>

        <section class="normative">
          <h3>ActivityPub</h3>

          <p>This section defines a minimal profile of [[ACTIVITYPUB]] that Activity Anchor Servers implement to participate in propagation flows.</p>

          <section class="normative">
            <h4>Actor (Discovery)</h4>
  
            <p>
              An <i>Actor</i> exposed by an Activity Anchor Server is capable of participating in propagation flows.
              ActivityPub endpoints are retrieved by performing an HTTP GET to the Actor endpoint.
              The Actor endpoint returns an <a href="https://www.w3.org/TR/activitypub/#actor-objects">Actor object</a>.
            </p>

            <pre class="example highlight" title="Actor retrieval">
              GET /services/anchor HTTP/1.1
              Host: alice.example.com
              Accept: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate
            </pre>

            <p>
              When the service profile exists, an HTTP 200 status code is returned.
            </p>

            <pre class="example highlight" title="Successful Actor response">
              HTTP/1.1 200 OK
              Date: Wed, 27 Jan 2021 21:57:25 GMT
              Content-Type: application/jrd+json; charset=utf-8
              Connection: keep-alive
              Access-Control-Allow-Origin: *

              {
                "@context": [
                "https://www.w3.org/ns/activitystreams",
                "https://w3id.org/security/v1",
                "https://w3id.org/activityanchors/v1"
                ],
                "id": "https://alice.example.com/services/anchor",
                "type": "Service",
                "publicKey": {
                  "id": "https://alice.example.com/services/anchor#main-key",
                  "owner": "https://alice.example.com/services/anchor",
                  "publicKeyPem": "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhki....."
                },
                "inbox": "https://alice.example.com/services/anchor/inbox",
                "outbox": "https://alice.example.com/services/anchor/outbox",
                "followers": "https://alice.example.com/services/anchor/followers",
                "following": "https://alice.example.com/services/anchor/following",
                "witnesses": "https://alice.example.com/services/anchor/witnesses",
                "witnessing": "https://alice.example.com/services/anchor/witnessing",
                "likes": "https://alice.example.com/services/anchor/likes",
                "liked": "https://alice.example.com/services/anchor/liked",
                "shares": "https://alice.example.com/services/anchor/shares"
              }
            </pre>

            <p class="issue" title="DID for service">
              TODO: Review handling of publicKey.
            </p>

          </section>

          <section class="normative">
            <h4>Delivery</h4>

            <p>
              Activity Anchor Servers use ActivityPub <a href="https://www.w3.org/TR/activitypub/#delivery">Delivery</a> mechanisms to propagate anchor activitys and to request to follow other servers.
              A propagation or follow request is sent by performing an HTTP POST of an activity to an Activity Anchor Server's ActivityPub inbox endpoint.
            </p>

            <p>
              Activity Anchor Servers use HTTP Signatures [[HTTP-SIGNATURES]] when calling Server-to-Server APIs to create authenticated messages.
              The anchor objects are additionally signed using JSON-LD proofs [[LDPROOF]] from both the Writer server as well as Witness servers.
            </p>
          </section>

          <section class="normative">
            <h4>Collections</h3>

            <p>
              Please refer to [[ACTIVITYPUB]] <a href="https://www.w3.org/TR/activitypub/#collections">section 5</a> for general collections guidance.
              An Activity Anchor Server exposes:
            </p>

            <ul>
              <li>Outbox: provides an ordered collection of the activities published by the server.</li>
              <li>Inbox: provides an ordered collection of the activities received by the server.</li>
              <li>Followers: provides a collection (or ordered collection) of the other Activity Anchor Servers following the server.</li>
              <li>Following: provides a collection (or ordered collection) of the other Activity Anchor Servers the server is following.</li>
              <li>Witnesses: provides a collection (or ordered collection) of the other Activity Anchor Servers that act as witnesses.</li>
              <li>Witnessing: provides a collection (or ordered collection) of the other Activity Anchor Servers the server is witnessing.</li>
              <li>Likes: provides an ordered collection of the processed and replicated anchor activities sent by an Activity Anchor Server.</li>
              <li>Liked: provides an ordered collection of the anchor activities processed and replicated by the Activity Anchor Server.</li>
              <li>Shares: provides an ordered collection of the propagation (announce) activities sent by the Activity Anchor Server.</li>
            </ul>
          </section>
  
          <section class="normative">
            <h4>Create Activity</h4>
            <p>
              An Activity Anchor Server that creates a anchor activity uses an <i>Create</i> activity to propagate that knowledge to its own followers.
              A anchor activity is propagated to another Activity Anchor Server by performing an HTTP POST of an <i>Create</i> activity containing an <i>AnchorCredential</i> to its ActivityPub inbox endpoint.
            </p>

            <pre class="example highlight" title="Propagating a new anchor activity">
              POST /services/anchor/inbox HTTP/1.1
              Host: alice.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": [
                  "https://www.w3.org/ns/activitystreams",
                  "https://w3id.org/activityanchors/v1"
                ],
                "id": "https://sally.example.com/services/anchor/activities/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                "type": "Create",
                "actor": "https://sally.example.com/services/anchor",
                "to": [
                  "https://sally.example.com/services/anchor/followers",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "published": "2021-01-27T09:30:10Z",
                "object": {
                  "type": "AnchorEvent",
                  "attributedTo": "https://example.domain1.com/services/example",
                  "index": "hl:uEiCF5Mr8n7NPsAGenkNIoY0tJtnqDUWMk_XdYpgOm5yNnA",
                  "parent": "hl:uEiAL-T2TdNkqL5gRIX8BZvrXESPOzoIYy98YUBxc5xAG0w:uoQ-BeEJpcGZzOi8vYmFma3JlaWFsN2U2emc1Z3pmaXh6cWVqYnA0YXduNnd4Y2VyNDV0dWNkZGY1NmdjcWRyb29vZWFnMm0",
                  "published": "2021-10-29T18:06:34.554883376Z",
                  "url": "hl:uEiAyUitoMn-ujmlFC6DBW2AlWabxGfVpGw0b3ymcqwzSHQ:uoQ-BeEJpcGZzOi8vYmFma3JlaWJza2l2d3FtdDd2Mmhnc3JpbHVkYXZ3eWJmbGd0cGNncHZuZW5xMmc2N2Znb2t3ZGdzZHU",
                  "attachment": [...]  
                }
              }
            </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>        
          </section>
  
          <section class="normative">
            <h4>Announce Activity</h4>
            <p>
              An Activity Anchor Server that learns about a new anchor activity that was created by another Activity Anchor Server uses an <i>Announce</i> activity to gossip that knowledge to its own followers.
              A anchor activity is forwarded to another Activity Anchor Server by performing an HTTP POST of an <i>Announce</i> activity containing an <i>AnchorCredential</i> to its ActivityPub inbox endpoint.
            </p>

            <pre class="example highlight" title="Propagating a forwarded anchor activity (without an embedded anchor credential)">
              POST /services/anchor/inbox HTTP/1.1
              Host: alice.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": [
                  "https://www.w3.org/ns/activitystreams",
                  "https://w3id.org/activityanchors/v1"
                ],
                "id": "https://sally.example.com/services/anchor/activities/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                "type": "Announce",
                "actor": "https://sally.example.com/services/anchor",
                "to": [
                  "https://sally.example.com/services/anchor/followers",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "published": "2021-01-27T09:30:10Z",
                "object": {
                  "type": "Collection",
                  "totalItems": 1,
                  "items": [
                    {
                      "type": "AnchorEvent",
                      "url": "hl:uEiAyUitoMn-ujmlFC6DBW2AlWabxGfVpGw0b3ymcqwzSHQ:uoQ-BeEJpcGZzOi8vYmFma3JlaWJza2l2d3FtdDd2Mmhnc3JpbHVkYXZ3eWJmbGd0cGNncHZuZW5xMmc2N2Znb2t3ZGdzZHU",
                    }
                  ]
                }
              }
            </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>

            <pre class="example highlight" title="Propagating a forwarded anchor activity (with an embedded anchor credential)">
              POST /services/anchor/inbox HTTP/1.1
              Host: alice.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": "https://www.w3.org/ns/activitystreams",
                "actor": "https://example.domain2.com/services/example",
                "id": "https://example.domain2.com/services/example/activities/be75048c-6463-4d59-ba7c-b376f331ee14",
                "object": {
                  "items": [
                    {
                      "@context": "https://w3id.org/activityanchors/v1",
                      "attachment": [
                        {
                          "contentObject": {
                            "properties": {
                              "https://w3id.org/activityanchors#generator": "https://example.com/spec#v1",
                              "https://w3id.org/activityanchors#resources": [
                                {
                                  "id": "did:example:uEiA7nHXweEsQJ38osrh4sIDC6qWtFBi59KH9mPVieqhZ2A:EiAg41m285JcxHNd2lBuQwtxFPHuZbupNFLTj-XaRKPXzQ",
                                  "previousAnchor": "hl:uEiA7nHXweEsQJ38osrh4sIDC6qWtFBi59KH9mPVieqhZ2A"
                                }
                              ]
                            },
                            "subject": "hl:uEiBk_3IacFfHbtWWeGoTiWNgGmSu-alJK8ygi55flvC-6g:uoQ-CeEtodHRwczovL29yYi5kb21haW4xLmNvbS9jYXMvdUVpQmtfM0lhY0ZmSGJ0V1dlR29UaVdOZ0dtU3UtYWxKSzh5Z2k1NWZsdkMtNmd4QmlwZnM6Ly9iYWZrcmVpZGU3NXpidTRjeHk1eG5sZnR5bmlqeXN5M2FkanNrNTZuampldjR6aWVsdHpwem40ZjY1aQ"
                          },
                          "generator": "https://example.com/spec#v1",
                          "tag": [
                            {
                              "href": "hl:uEiCQP9wIPE0EmK9bJzCNtGb_8uOO-fdQfslau1aXP4DL_Q",
                              "rel": [
                                "witness"
                              ],
                              "type": "Link"
                            }
                          ],
                          "type": "AnchorObject",
                          "url": "hl:uEiCpDgdsT7zHRambMrQAX8iKiyBnlNryJoXoFRw6XUpsjQ"
                        },
                        {
                          "contentObject": {
                            "@context": [
                              "https://www.w3.org/2018/credentials/v1",
                              "https://w3id.org/security/suites/jws-2020/v1"
                            ],
                            "credentialSubject": "hl:uEiCpDgdsT7zHRambMrQAX8iKiyBnlNryJoXoFRw6XUpsjQ",
                            "id": "https://example2.domain1.com/vc/2e8bde2b-28d3-4bae-bb53-7b0829b2e4bc",
                            "issuanceDate": "2021-11-12T19:35:18.0020806Z",
                            "issuer": "https://example2.domain1.com",
                            "proof": [
                              {
                                "created": "2021-11-12T19:35:18.009Z",
                                "domain": "http://example.vct:8077/maple2020",
                                "jws": "eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..f1_1LbWyMPEP06F3B3fERyflDrQK4QGWmLvaSOlgYIoITytEcARDiE4htVwmJz1iXDWZGNwl1ic9SVyDxw6UAg",
                                "proofPurpose": "assertionMethod",
                                "type": "Ed25519Signature2018",
                                "verificationMethod": "did:web:example.domain1.com#example1key"
                              },
                              {
                                "created": "2021-11-12T19:35:18.1946195Z",
                                "domain": "https://example.domain2.com",
                                "jws": "eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..iIYVqDs8qdaHomub8J_X7yGLcdyrGuq2LGpz6z2dZYOI4mfTViDzYIi6vt4e5p-SeMgChqyhMZeGTKNOuYOXCg",
                                "proofPurpose": "assertionMethod",
                                "type": "Ed25519Signature2018",
                                "verificationMethod": "did:web:example.domain2.com#example2key"
                              }
                            ],
                            "type": "VerifiableCredential"
                          },
                          "generator": "https://example.com/spec#v1",
                          "type": "AnchorObject",
                          "url": "hl:uEiCQP9wIPE0EmK9bJzCNtGb_8uOO-fdQfslau1aXP4DL_Q"
                        }
                      ],
                      "attributedTo": "https://example.domain1.com/services/example",
                      "index": "hl:uEiCpDgdsT7zHRambMrQAX8iKiyBnlNryJoXoFRw6XUpsjQ",
                      "parent": "hl:uEiA7nHXweEsQJ38osrh4sIDC6qWtFBi59KH9mPVieqhZ2A:uoQ-CeEtodHRwczovL29yYi5kb21haW4xLmNvbS9jYXMvdUVpQTduSFh3ZUVzUUozOG9zcmg0c0lEQzZxV3RGQmk1OUtIOW1QVmllcWhaMkF4QmlwZnM6Ly9iYWZrcmVpYjN0cjI3YTZjbGNhdHg2a2ZzeGI0bGJhZ2M1a3MyMmZheXhoMmtkN215NnZyaHZrY3ozYQ",
                      "published": "2021-11-12T19:35:18.0017151Z",
                      "type": "AnchorEvent",
                      "url": "hl:uEiB14RklxzqmoiOpQ7KAoQQukw4rIjXhycqZbeqNBq8ecg:uoQ-CeEtodHRwczovL29yYi5kb21haW4xLmNvbS9jYXMvdUVpQjE0UmtseHpxbW9pT3BRN0tBb1FRdWt3NHJJalhoeWNxWmJlcU5CcThlY2d4QmlwZnM6Ly9iYWZrcmVpZHY0ZW1zbHJ6MnUycmNoa2tkd2tha2NiYm9zbWhjd2lydjRoZTR2Z2xuNWtncW5seTZvaQ"
                    }
                  ],
                  "totalItems": 1,
                  "type": "Collection"
                },
                "published": "2021-11-12T19:35:18.7688724Z",
                "to": [
                  "https://example.domain2.com/services/example/followers",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "type": "Announce"
              }
            </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>
          </section>

          <section class="normative">
            <h4>Follow Activity</h4>
              <p>
                An Activity Anchor Server requests to follow another Activity Anchor Server by performing an HTTP POST of a <i>Follow</i> activity to its ActivityPub inbox endpoint.
                Refer to <a href="https://www.w3.org/TR/activitypub/#follow-activity-inbox">ActivityPub</a> for guidance. 
              </p>

              <pre class="example highlight" title="Request to follow an Activity Anchor Server">
                POST /services/anchor/inbox HTTP/1.1
                Host: alice.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate
  
                {
                  "@context": "https://www.w3.org/ns/activitystreams",
                  "id": "https://sally.example.com/activities/9052018f-9530-4aef-8a46-40bde9445a25",
                  "type": "Follow",
                  "to": "https://alice.example.com/services/anchor",
                  "actor": "https://sally.example.com/services/anchor",
                  "object": "https://alice.example.com/services/anchor"
                }
              </pre>

              <p>
                On success, HTTP status code 200 is returned.
              </p>
          </section>

          <section class="normative">
            <h4>Accept Follow Activity</h4>
              <p>
                An Activity Anchor Server accepts a Follow request by sending an HTTP POST of a <i>Accept</i> activity to the requesting Activity Anchor Server's ActivityPub inbox endpoint.
                Refer to <a href="https://www.w3.org/TR/activitypub/#accept-activity-inbox">ActivityPub</a> for guidance. 
              </p>

              <pre class="example highlight" title="Accept follow request from an Activity Anchor Server">
                POST /services/anchor/inbox HTTP/1.1
                Host: sally.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate
  
                {
                  "@context": "https://www.w3.org/ns/activitystreams",
                  "id": "https://alice.example.com/activities/e017e49a-6256-44a0-855d-5dc304ae67f7",
                  "to": "https://sally.example.com/services/anchor",
                  "type": "Accept",
                  "actor": "https://alice.example.com/services/anchor",
                  "object": {
                      "id": "https://sally.example.com/activities/9052018f-9530-4aef-8a46-40bde9445a25",
                      "to": "https://alice.example.com/services/anchor",
                      "type": "Follow",
                      "actor": "https://sally.example.com/services/anchor",
                      "object": "https://alice.example.com/services/anchor"
                    }
                }
              </pre>

              <p>
                On success, HTTP status code 200 is returned.
              </p>  
          </section>

          <section class="normative">
            <h4>Reject Follow Activity</h4>
              <p>
                An Activity Anchor Server rejects a Follow request by sending an HTTP POST of a <i>Reject</i> activity to the requesting Activity Anchor Server's ActivityPub inbox endpoint.
                Refer to <a href="https://www.w3.org/TR/activitypub/#reject-activity-inbox">ActivityPub</a> for guidance. 
              </p>

              <pre class="example highlight" title="Reject follow request from an Activity Anchor Server">
                POST /services/anchor/inbox HTTP/1.1
                Host: sally.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate
  
                {
                  "@context": "https://www.w3.org/ns/activitystreams",
                  "id": "https://alice.example.com/activities/e017e49a-6256-44a0-855d-5dc304ae67f7",
                  "to": "https://sally.example.com/services/anchor",
                  "type": "Reject",
                  "actor": "https://alice.example.com/services/anchor",
                  "object": {
                      "id": "https://sally.example.com/activities/9052018f-9530-4aef-8a46-40bde9445a25",
                      "to": "https://alice.example.com/services/anchor",
                      "type": "Follow",
                      "actor": "https://sally.example.com/services/anchor",
                      "object": "https://alice.example.com/services/anchor"
                    }
                }
              </pre>

              <p>
                On success, HTTP status code 200 is returned.
              </p>  
          </section>

          <section class="normative">
            <h4>Undo Follow Activity</h4>
              <p>
                An Activity Anchor Server requests to stop following by sending an HTTP POST of a <i>Undo</i> activity to an Activity Anchor Server's ActivityPub inbox endpoint.
                Refer to <a href="https://www.w3.org/TR/activitypub/#undo-activity-outbox">ActivityPub</a> for guidance. 
              </p>

              <pre class="example highlight" title="Reject follow request from an Activity Anchor Server">
                POST /services/anchor/inbox HTTP/1.1
                Host: sally.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate
  
                {
                  "@context": "https://www.w3.org/ns/activitystreams",
                  "id": "https://sally.example.com/activities/e017e49a-6256-44a0-855d-5dc304ae67f7",
                  "to": "https://alice.example.com/services/anchor",
                  "type": "Undo",
                  "actor": "https://sally.example.com/services/anchor",
                  "object": {
                      "id": "https://sally.example.com/activities/9052018f-9530-4aef-8a46-40bde9445a25",
                      "to": "https://alice.example.com/services/anchor",
                      "type": "Follow",
                      "actor": "https://sally.example.com/services/anchor",
                      "object": "https://alice.example.com/services/anchor"
                    }
                }
              </pre>

              <p>
                On success, HTTP status code 200 is returned.
              </p>  
          </section>          

          <section class="normative">
            <h4>Like Activity</h4>
            <p>
              An Activity Anchor Server MAY notify other actors that it has successfully processed an anchor event using the <i>Like</i> activity.
              In particular, it is useful for the originator of the anchor to discover other actors that are processing the events it is producing.
              Processing an anchor event MAY also result in the creation of an additional reference to the anchor event due to replication.
              The <i>result</i> property MAY be included to allow other actors to discover the additional anchor reference.
              Note: the new anchor reference MAY contain multiple links to the anchor event (representing multiple replication sources).
            </p>
            
            <pre class="example highlight" title="Notifying the originator of successful processing and replication">
              POST /services/anchor/inbox HTTP/1.1
              Host: alice.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": "https://www.w3.org/ns/activitystreams",
                "actor": "https://example.domain2.com/services/example",
                "id": "https://example.domain2.com/services/example/activities/7499c22a-e6b1-4b6c-baff-a555872239b4",
                "object": {
                  "@context": "https://w3id.org/activityanchors/v1",
                  "type": "AnchorEvent",
                  "url": "hl:uEiB14RklxzqmoiOpQ7KAoQQukw4rIjXhycqZbeqNBq8ecg:uoQ-CeEtodHRwczovL29yYi5kb21haW4xLmNvbS9jYXMvdUVpQjE0UmtseHpxbW9pT3BRN0tBb1FRdWt3NHJJalhoeWNxWmJlcU5CcThlY2d4QmlwZnM6Ly9iYWZrcmVpZHY0ZW1zbHJ6MnUycmNoa2tkd2tha2NiYm9zbWhjd2lydjRoZTR2Z2xuNWtncW5seTZvaQ"
                },
                "published": "2021-11-12T19:35:18.9545239Z",
                "result": {
                  "@context": "https://w3id.org/activityanchors/v1",
                  "type": "AnchorEvent",
                  "url": "hl:uEiB14RklxzqmoiOpQ7KAoQQukw4rIjXhycqZbeqNBq8ecg:uoQ-BeEtodHRwczovL29yYi5kb21haW4yLmNvbS9jYXMvdUVpQjE0UmtseHpxbW9pT3BRN0tBb1FRdWt3NHJJalhoeWNxWmJlcU5CcThlY2c"
                },
                "to": [
                  "https://example.domain1.com/services/example",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "type": "Like"
              }              
            </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>
          </section>
  
          <section class="normative">
            <h4>Undo Like Activity</h4>
            <p>
              An Activity Anchor Server MAY notify other actors that it no longer uses an anchor (or stops replicating the anchor) that it previously liked.
              Refer to <a href="https://www.w3.org/TR/activitypub/#undo-activity-outbox">ActivityPub</a> for guidance. 
            </p>
            
            <pre class="example highlight" title="Notifying the originator that the anchor is no longer liked">
              POST /services/anchor/inbox HTTP/1.1
              Host: alice.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": [
                  "https://www.w3.org/ns/activitystreams",
                  "https://w3id.org/activityanchors/v1"
                ],
                "id": "https://sally.example.com/activities/e017e49a-6256-44a0-855d-5dc304ae67f7",
                "to": [
                  "https://alice.example.com/services/anchor",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "type": "Undo",
                "actor": "https://sally.example.com/services/anchor",
                "object": {
                  "id": "https://sally.example.com/services/anchor/activities/d2f4b508-021c-48a2-ad08-8949970366b2",
                  "type": "Like",
                  "actor": "https://sally.example.com/services/anchor",
                  "to": [
                    "https://alice.example.com/services/anchor",
                    "https://www.w3.org/ns/activitystreams#Public"
                  ],
                  "published": "2021-01-27T09:30:10Z",
                  "object": {
                    "type": "AnchorEvent",
                    "url": "hl:uEiCsFp-ft8tI1DFGbXs78tw-HS561mMPa3Z6GsGAHElrNQ:uoQ-CeE1odHRwczovL3NhbGx5LmV4YW1wbGUuY29tL2Nhcy91RWlDc0ZwLWZ0OHRJMURGR2JYczc4dHctSFM1NjFtTVBhM1o2R3NHQUhFbHJOUXhCaXBmczovL2JhZmtyZWlmbWMycHo3bjZsamRrZGNydG5wbTU3ZnhiNmR1eGh2dnRkYjV2eG02cTJ5Z2FieXNsbGd1"
                  },
                  "result": {
                    "type": "AnchorEvent",
                    "url": "hl:uEiCsFp-ft8tI1DFGbXs78tw-HS561mMPa3Z6GsGAHElrNQ:uoQ-BeDhodHRwczovL2V4YW1wbGUuY29tL2NmMTQ5YTY4LTA4NTYtNDMwNC1hOWVjLTM0NzU2NzU1NDE2Yw"
                  }
                }
              }
            </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>
          </section>

        </section>

        <section class="normative" id='witness-activitypub'>
          <h3>Witness ActivityPub</h3>

          <section class="normative">
            <h4>Invite Witness Activity</h4>
            <p>
              An Activity Anchor Server invites another Activity Anchor Server to be a witness by performing an HTTP POST of an <i>Invite</i> activity containing a <i>witnesses</i> object to its ActivityPub inbox endpoint.
            </p>

            <pre class="example highlight" title="Request to invite an Activity Anchor Server to be a witness">
                POST /services/anchor/inbox HTTP/1.1
                Host: alice.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate

                {
                  "@context": [
                    "https://www.w3.org/ns/activitystreams",
                    "https://w3id.org/activityanchors/v1"
                  ],
                  "id": "https://sally.example.com/activities/7052018f-9530-3aef-8a46-20bde9445a21",
                  "to": "https://alice.example.com/services/anchor",
                  "type": "Invite",
                  "actor": "https://sally.example.com/services/anchor",
                  "object": "https://w3id.org/activityanchors#AnchorWitness",
                  "target": "https://alice.example.com/services/anchor"
                }
              </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>
          </section>

          <section class="normative">
            <h4>Accept Invite Witness Activity</h4>
            <p>
              An Activity Anchor Server accepts an Invite Witness request by sending an HTTP POST of a <i>Accept</i> activity to the requesting Activity Anchor Server's ActivityPub inbox endpoint.
              Upon receiving this activity, the requesting Activity Anchor Server adds the actor to its collection of 'witnesses'.
              Refer to <a href="https://www.w3.org/TR/activitypub/#accept-activity-inbox">ActivityPub</a> for guidance.
            </p>

            <pre class="example highlight" title="Accept invite witness request from an Activity Anchor Server">
                POST /services/anchor/inbox HTTP/1.1
                Host: sally.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate

                {
                  "@context": [
                    "https://www.w3.org/ns/activitystreams",
                    "https://w3id.org/activityanchors/v1"
                  ],
                  "id": "https://alice.example.com/activities/f017e49a-7256-44a0-255d-3dc304ae67f7",
                  "to": "https://sally.example.com/services/anchor",
                  "type": "Accept",
                  "actor": "https://alice.example.com/services/anchor",
                  "object": {
                    "type": "Invite",
                    "id": "https://sally.example.com/activities/7052018f-9530-3aef-8a46-20bde9445a21",
                    "actor": "https://sally.example.com/services/anchor",
                    "object": "https://w3id.org/activityanchors#AnchorWitness",
                    "target": "https://alice.example.com/services/anchor"
                  }
                }
              </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>
          </section>

          <section class="normative">
            <h4>Reject Invite Witness Activity</h4>
            <p>
              An Activity Anchor Server rejects an Invite Witness request by sending an HTTP POST of a <i>Reject</i> activity to the requesting Activity Anchor Server's ActivityPub inbox endpoint.
              Refer to <a href="https://www.w3.org/TR/activitypub/#reject-activity-inbox">ActivityPub</a> for guidance.
            </p>

            <pre class="example highlight" title="Reject invite witness request from an Activity Anchor Server">
                POST /services/anchor/inbox HTTP/1.1
                Host: sally.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate

                {
                  "@context": [
                    "https://www.w3.org/ns/activitystreams",
                    "https://w3id.org/activityanchors/v1"
                  ],
                  "id": "https://alice.example.com/activities/b013e49a-6256-24a0-855d-1dc304ar67f7",
                  "to": "https://sally.example.com/services/anchor",
                  "type": "Reject",
                  "actor": "https://alice.example.com/services/anchor",
                  "object": {
                    "type": "Invite",
                    "id": "https://sally.example.com/activities/7052018f-9530-3aef-8a46-20bde9445a21",
                    "actor": "https://sally.example.com/services/anchor",
                    "object": "https://w3id.org/activityanchors#AnchorWitness",
                    "target": "https://alice.example.com/services/anchor"
                  }
                }
              </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>
          </section>

          <section class="normative">
            <h4>Undo Invite Witness Activity</h4>
            <p>
              An Activity Anchor Server notifies a Witness that they have been removed by sending an HTTP POST of a <i>Undo</i> activity to an Activity Anchor Server's ActivityPub inbox endpoint.
              Refer to <a href="https://www.w3.org/TR/activitypub/#undo-activity-outbox">ActivityPub</a> for guidance.
            </p>

            <pre class="example highlight" title="Reject invite witness request from an Activity Anchor Server">
                POST /services/anchor/inbox HTTP/1.1
                Host: sally.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate

                {
                  "@context": [
                    "https://www.w3.org/ns/activitystreams",
                    "https://w3id.org/activityanchors/v1"
                  ],
                  "id": "https://sally.example.com/activities/b013e49a-6256-24a0-855d-1dc304ar67f7",
                  "to": "https://alice.example.com/services/anchor",
                  "type": "Undo",
                  "actor": "https://sally.example.com/services/anchor",
                  "object": {
                    "type": "Invite",
                    "id": "https://sally.example.com/activities/7052018f-9530-3aef-8a46-20bde9445a21",
                    "actor": "https://sally.example.com/services/anchor",
                    "object": "https://w3id.org/activityanchors#AnchorWitness",
                    "target": "https://alice.example.com/services/anchor"
                  }
                }
              </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>
          </section>

          <section class="normative">
            <h4>Offer Activity</h4>

            <p>
              An Activity Anchor Server sends a <i>preannouncement</i> of an anchor using an <i>Offer</i> activity populated with an <i>AnchorCredential</i>.
              The <i>AnchorCredential</i> contains a Linked Data Proof from the activity server.
              The <i>Offer</i> activity also includes a <i>startTime</i> and <i>endTime</i> indicating the time period where the Activity Anchor Server will accept
              linked data proofs for inclusion into the anchor activity.
              The <i>startTime</i> is the current timestamp for the Activity Anchor Server.
              The <i>endTime</i> is the cut-off timestamp for inclusion into the activity.
            </p>

            <pre class="example highlight" title="Propagating a new anchor activity (with an embedded anchor credential)">
              POST /services/anchor/inbox HTTP/1.1
              Host: witness1.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": "https://www.w3.org/ns/activitystreams",
                "actor": "https://example.domain1.com/services/example",
                "endTime": "2021-11-12T19:45:50.7676356Z",
                "id": "https://example.domain1.com/services/example/activities/db7e80d5-94a7-41b4-b951-2219e6800023",
                "object": {
                  "@context": "https://w3id.org/activityanchors/v1",
                  "attachment": [...],
                  "attributedTo": "https://example.domain1.com/services/example",
                  "index": "hl:uEiBz8xiBcw5uw5dJHiXE_Sj-6kqB1pW55OlnW3J5_S58Iw",
                  "published": "2021-11-12T19:35:50.6898963Z",
                  "type": "AnchorEvent"
                },
                "startTime": "2021-11-12T19:35:50.7676356Z",
                "target": "https://w3id.org/activityanchors#AnchorWitness",
                "to": [
                  "https://example.domain2.com/services/example",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "type": "Offer"
              }
            </pre>
          </section>

          <section class="normative">
            <h4>Accept Anchor Activity</h4>

            <p>
              A Witness promises to include an anchor event into their ledger using a <i>Accept</i> activity populated with its linked data proof
              of an <i>AnchorCredential</i> received in a previous <i>Offer</i>.
              A reference to the previously offered object is populated into the <i>object</i> field.
              The Witness includes the time range when the anchor activity will become included into their ledger using <i>startTime</i> and <i>endTime</i> fields.
            </p>

            <pre class="example highlight" title="Providing a Linked Data Proof as a witness">
              POST /services/anchor/inbox HTTP/1.1
              Host: witness1.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": "https://www.w3.org/ns/activitystreams",
                "actor": "https://example.domain2.com/services/example",
                "id": "https://example.domain2.com/services/example/activities/fa6cb5b5-e114-4fdc-b717-2321d853cd50",
                "object": {
                  "@context": "https://www.w3.org/ns/activitystreams",
                  "actor": "https://example.domain1.com/services/example",
                  "id": "https://example.domain1.com/services/example/activities/db7e80d5-94a7-41b4-b951-2219e6800023",
                  "object": "hl:uEiBz8xiBcw5uw5dJHiXE_Sj-6kqB1pW55OlnW3J5_S58Iw",
                  "target": "https://w3id.org/activityanchors#AnchorWitness",
                  "to": [
                    "https://example.domain2.com/services/example",
                    "https://www.w3.org/ns/activitystreams#Public"
                  ],
                  "type": "Offer"
                },
                "result": {
                  "attachment": [
                    {
                      "@context": [
                        "https://w3id.org/security/v1",
                        "https://w3id.org/security/suites/jws-2020/v1"
                      ],
                      "proof": {
                        "created": "2021-11-12T19:35:50.8619224Z",
                        "domain": "https://example.domain2.com",
                        "jws": "eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19..gWh0WjiWB-st6pxGTD6zdyfNyEDJqBIfIU4jj7UYR54IDoqizFvvf1GZw_-89puhvjNHjsYxAWt0rDU7lY4KDg",
                        "proofPurpose": "assertionMethod",
                        "type": "Ed25519Signature2018",
                        "verificationMethod": "did:web:example.domain2.com#example2key"
                      }
                    }
                  ],
                  "endTime": "2021-11-12T19:45:50.8767317Z",
                  "inReplyTo": "hl:uEiBz8xiBcw5uw5dJHiXE_Sj-6kqB1pW55OlnW3J5_S58Iw",
                  "startTime": "2021-11-12T19:35:50.8767317Z",
                  "type": "AnchorReceipt"
                },
                "to": [
                  "https://example.domain1.com/services/example",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "type": "Accept"
              }              
            </pre>

            <p>
              The Writer Activity Anchor Server assembles the linked data proofs into a proof chain to create the final <i>AnchorCredential</i>.
              The proof chain starts with the Writer's linked data proof followed by each witness's linked data proof.
              See <a href="#anchorcredential"></a>.
            </p>

            <p class="issue" title="Log-specific attachments">
              Determine if it makes sense to also include log-specific attachments such as signed certificate timestamps.
            </p>
          </section>

          <section class="normative">
            <h4>Reject Anchor Activity</h4>

            <p class="issue" title="Provide description">
              TODO: Provide description and example for Reject.
            </p>
          </section>

        </section>

        <section class="normative">
          <h3>WebFinger</h3>

          <p>
            WebFinger [[RFC7033]] is used to discover endpoints for anchor service and resource URIs.
          </p>

          <p>The following example retrieves endpoints for a service named anchor at alice.example.com.</p>

          <pre class="example highlight" title="Discover endpoints for an Anchor service (request).">
            GET /.well-known/webfinger?resource=https%3A%2F%2Falice.example.com%2Fservices%2Fanchor HTTP/1.1
            Host: alice.example.com
            Accept-Encoding: gzip, deflate
          </pre>

          <p>
            When the resource exists, an HTTP 200 status code is returned.
          </p>

          <pre class="example highlight" title="Discover endpoints for an Anchor service (response).">
            HTTP/1.1 200 OK
            Date: Sat, 30 Jan 2021 13:20:11 GMT
            Content-Type: application/jrd+json
            Connection: keep-alive
            Access-Control-Allow-Origin: *

            {
              "subject": "https://alice.example.com/services/anchor",
              "aliases": [
                "https://alice.example.com/@anchor",
                "https://alice.example.com/services/anchor"
              ],
              "links": [
                {
                  "rel": "self",
                  "type": "application/activity+json",
                  "href": "https://alice.example.com/services/anchor"
                }
              ]
            }
          </pre>

          <p>
            Aliases for a resource can also be queried. For example, the following is a request for anchor@alice.example.com.
            This request has the same response as the prior example.
          </p>

          <pre class="example highlight" title="Discover endpoints for an Anchor service using service alias.">
            GET /.well-known/webfinger?resource=acct%anchor%40alice.example.com HTTP/1.1
            Host: alice.example.com
            Accept-Encoding: gzip, deflate
          </pre>

          <p>
            WebFinger is also used to query for resource endpoint discovery.
          </p>

          <pre class="example highlight" title="Discover endpoints for an anchor service (request).">
            GET /.well-known/webfinger?resource=https%3A%2F%2Fsally.example.com%2Fanchor activitys%2Fbafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y HTTP/1.1
            Host: sally.example.com
            Accept-Encoding: gzip, deflate
          </pre>

          <p>
            When the resource exists, an HTTP 200 status code is returned.
          </p>

          <pre class="example highlight" title="Discover endpoints for an anchor service (response).">
            HTTP/1.1 200 OK
            Date: Sat, 30 Jan 2021 13:20:11 GMT
            Content-Type: application/jrd+json
            Connection: keep-alive
            Access-Control-Allow-Origin: *

            {
              "subject": "https://sally.example.com/anchors/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
              "links": [
                {
                  "rel": "self",
                  "type": "application/ld+json",
                  "href": "https://sally.example.com/anchors/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y"
                },
                {
                  "rel": "working-copy",
                  "type": "application/ld+json",
                  "href": "https://sally.example.com/cas/uEiCsFp-ft8tI1DFGbXs78tw-HS561mMPa3Z6GsGAHElrNQ"
                },
                {
                  "rel": "working-copy",
                  "type": "application/ld+json",
                  "href": "https://replica.example.com/cas/uEiCsFp-ft8tI1DFGbXs78tw-HS561mMPa3Z6GsGAHElrNQ"
                }
              ]
            }
          </pre>

          <p class="issue" title="Link relations">
            Review the appropriate link relations in the above example.
          </p>

        </section>

    </section>

    <section id='conformance'>
      <!-- This section is filled automatically by ReSpec. -->
    </section>
  </body>
</html>