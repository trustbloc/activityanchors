<!DOCTYPE html>
<html>
  <head>
    <title>Activity Anchors v0.1</title>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c' async class='remove'></script>
    <script class='remove'>
      var respecConfig = {
        specStatus: "unofficial",
        subtitle: "An anchoring system for a fediverse of interconnected nodes and witnesses",
        editors: [{
          name: "Troy Ronda", url: "https://www.linkedin.com/in/troyronda/",
          company: "SecureKey", companyURL: "https://securekey.com/"
        }],
        github: "https://github.com/trustbloc/activityanchors",
        localBiblio: {
          "LDPROOF": {
            title: "Linked Data Proofs 1.0",
            href: "https://w3c-ccg.github.io/ld-proofs/",
            publisher: "W3C CCG",
            status: "Draft Community Group Report"
          },
          "CID": {
            title: "CID (Content IDentifier) Specification",
            href: "https://github.com/multiformats/cid",
            publisher: "Multiformats"
          },
          "HASHLINK": {
            title: "Cryptographic Hyperlinks",
            date: "May 2021",
            href: "https://tools.ietf.org/html/draft-sporny-hashlink-07",
            authors: [
              "M. Sporny",
              "L. Rosenthol"
            ],
            status: "Internet-Draft",
            publisher: "IETF"
          }          
        }
      };
    </script>
  </head>
  <body>
    <section id='abstract'>
      <p>
        Activity Anchors are based on a federated and replicated
        <a href="https://www.w3.org/TR/did-core/#dfn-verifiable-data-registry">Verifiable Data Registry</a> (VDR).
        The decentralized network consists of Activity Anchor Servers that write, monitor, witness, and propagate batches of document operations.
        The batches form a graph that is propagated and replicated between the servers as content-addressable objects.
        These content-addressable objects can be located via both domain and distributed hash table (DHT) mechanisms.
        Each Activity Anchor witness server observes a subset of batches in the graph and includes them in their ledgers (as append-only Merkle Tree logs).
        The servers coordinate by propagating batches of document operations and by monitoring the applicable witness servers' ledgers.
        The Activity Anchor servers form a decentralized network without reliance on a common blockchain for coordination.
      </p>

      <p>
        This document specifies a data model and rules for representing a graph of batches, 
        the anchor server API,
        an [[[ACTIVITYSTREAMS-CORE]]] vocabulary and an [[[ACTIVITYPUB]]] profile for propagating batches,
        and a [[[RFC7033]]] profile for discovering endpoints.
      </p>
    </section>
    <section id='sotd'>
      <p>
      </p>
    </section>
    
    <section class="informative">
        <h2>Introduction</h2>

        <p>
          Our motivation for Activity Anchors is to enable many independent organizations to create <a href="https://www.w3.org/TR/did-core/#dfn-verifiable-data-registry">
          Verifiable Data Registries</a> (VDRs) that can become connected over time.
          In designing Activity Anchors, we have the goal to enable these VDRs to interconnect into a decentralized network without the need to choose a common public
          blockchain or to rely on special-purpose consortiums to form (and remain in operation).
          Activity Anchors enables a federated, replicated and scalable VDR based on a decentralized network for propagating, witnessing and replicating changes to documents.
        </p>

    </section>

    <section class="normative">
        <h2>Server-to-Server APIs</h2>

        <p>
          An Activity Anchor Server exposes APIs for propagation, content-addressable storage, discovery, and witnessing.
        </p>

        <section class="normative">
          <h3>Vocabulary</h3>

          <section class="normative" id="anchorevent">
            <h4>AnchorEvent</h4>

            <p>
              An operation batch is represented as an <i>AnchorEvent</i>.
              Hashlinks [[HASHLINK]] are used to link objects to the AnchorEvent.  
            </p>

            <pre class="example highlight" title="Operation batch">
            {
              "type": "AnchorEvent",
              "attributedTo": "ipns://k51qzi5uqu5dl3ua2aal8vdw82j4i8s112p495j1spfkd2blqygghwccsw1z0p",
              "published": "2021-01-27T09:30:00Z",
              "previous": [
                "hl:uEiAsiwjaXOYDmOHxmvDl3Mx0TfJ0uCar5YXqumjFJUNIBg:uoQ-CeEdodHRwczovL2V4YW1wbGUuY29tL2Nhcy91RWlBc2l3amFYT1lEbU9IeG12RGwzTXgwVGZKMHVDYXI1WVhxdW1qRkpVTklCZ3hCaXBmczovL2JhZmtyZWlibXJtZW51eGhnYW9tb2Q0bTI2ZHM1enRkdWp4emhqb2JndnBzeWwydjJuZGNza3EyaWF5",
                "hl:uEiAn3Y7USoP_lNVX-f0EEu1ajLymnqBJItiMARhKBzAKWg:uoQ-CeEdodHRwczovL2V4YW1wbGUuY29tL2Nhcy91RWlBbjNZN1VTb1BfbE5WWC1mMEVFdTFhakx5bW5xQkpJdGlNQVJoS0J6QUtXZ3hCaXBmczovL2JhZmtyZWliaDN3aG5pc3VkNzZrbmt2N3o3dWNiZjNrMnJzNmtuaHZhamVybnJkYWJkYmZhb21ha2xp"
              ],
              "attachment": [
                {
                  "type": "AnchorIndex",
                  "generator": "https://example.com/spec#v1",
                  "url": "hl:uEiD2k2kSGESB9e3UwwTOJ8WhqCeAT8fzKfQ9JzuGIYcHdg:uoQ-CeEdodHRwczovL2V4YW1wbGUuY29tL2Nhcy91RWlEMmsya1NHRVNCOWUzVXd3VE9KOFdocUNlQVQ4ZnpLZlE5Snp1R0lZY0hkZ3hCaXBmczovL2JhZmtyZWlod3NudXJlZ2NlcWgyNjN2Z2RhdGhjcHJuYnZhdHlhdDZoNm11N2lwamhob2RjZGJ5aG95",
                  "resources": [
                    "urn:multihash:uEiDahaOGH-liLLdDtTxEAdc8i-cfCz-WUcQdRJheMVNn3A",
                    {
                      "type": "AnchorResource",
                      "id": "urn:multihash:uEiA329wd6Aj36YRmp7NGkeB5ADnVt8ARdMZMPzfXsjwTJA",
                      "previousAnchor": "hl:uEiAsiwjaXOYDmOHxmvDl3Mx0TfJ0uCar5YXqumjFJUNIBg"
                    },
                    {
                      "type": "AnchorResource",
                      "id": "urn:multihash:uEiARIc_M1ZE_CmP-xApv_UTqZPncE1xmY0ugAdELz0MCogo",
                      "previousAnchor": "hl:uEiAn3Y7USoP_lNVX-f0EEu1ajLymnqBJItiMARhKBzAKWg"
                    }
                  ]
                },
                {
                  "type": "AnchorObject",
                  "url": "hl:uEiCrkp_NVZQDeWB5LqC5jK9f2va2BkXk7ySMKNt0Jg85Pg:uoQ-CeEdodHRwczovL2V4YW1wbGUuY29tL2Nhcy91RWlDcmtwX05WWlFEZVdCNUxxQzVqSzlmMnZhMkJrWGs3eVNNS050MEpnODVQZ3hCaXBmczovL2JhZmtyZWlmbHNrcDQydm11YW40d2E2am91YzR5emwyNzNsM2xtYnNmNHR4c2pkYmkzbjJjbWR6emh5"
                }
              ]
            }         
            </pre>

            <pre class="example highlight" title="Cryptographic Hyperlink Example">
              hl:uEiAsiwjaXOYDmOHxmvDl3Mx0TfJ0uCar5YXqumjFJUNIBg:uoQ-CeEdodHRwczovL2V4YW1wbGUuY29tL2Nhcy91RWlBc2l3amFYT1lEbU9IeG12RGwzTXgwVGZKMHVDYXI1WVhxdW1qRkpVTklCZ3hCaXBmczovL2JhZmtyZWlibXJtZW51eGhnYW9tb2Q0bTI2ZHM1enRkdWp4emhqb2JndnBzeWwydjJuZGNza3EyaWF5",
            </pre>

            <p>
            The example hashlink includes links to `https://example.com/cas/uEiAsiwjaXOYDmOHxmvDl3Mx0TfJ0uCar5YXqumjFJUNIBg` and `ipfs://bafkreibmrmenuxhgaomod4m26ds5ztdujxzhjobgvpsyl2v2ndcskq2iay` to demonstrate that multiple sources and protocols can be used for each object.
            </p>

            <p class="issue" title="Describe vocabulary">
              TODO: Complete the description of anchor events.
            </p>

          </section>

          <section class="normative" id="anchorcredential">
            <h4>AnchorCredential</h4>

            <p>
              A signed operation batch is represented as an <i>AnchorCredential</i>.
            </p>

            <pre class="example highlight" title="Operation batch">
              {
                "@context": [
                  "https://www.w3.org/2018/credentials/v1",
                  "https://www.w3.org/ns/activitystreams",
                  "https://w3id.org/activityanchors/v1",
                  "https://w3id.org/jws/v1"
                ],
                "id": "http://sally.example.com/anchors/bafkreihwsnuregceqh263vgdathcprnbvatyat6h6mu7ipjhhodcdbyhoy",
                "type": [
                  "VerifiableCredential",
                  "AnchorCredential"
                ],
                "issuer": "https://sally.example.com/services/anchor",
                "issuanceDate": "2021-01-27T09:30:10Z",
                "credentialSubject": {
                  "type": "AnchorEvent"
                },
                "proof": [{
                  "type": "JsonWebSignature2020",
                  "proofPurpose": "assertionMethod",
                  "created": "2021-01-27T09:30:00Z",
                  "verificationMethod": "did:example:abcd#key",
                  "domain": "sally.example.com",
                  "jws": "eyJ..."
                },
                {
                  "type": "JsonWebSignature2020",
                  "proofPurpose": "assertionMethod",
                  "created": "2021-01-27T09:30:05Z",
                  "verificationMethod": "did:example:abcd#key",
                  "domain": "https://witness1.example.com/ledgers/maple2021",
                  "jws": "eyJ..."
                },
                {
                  "type": "JsonWebSignature2020",
                  "proofPurpose": "assertionMethod",
                  "created": "2021-01-27T09:30:06Z",
                  "verificationMethod": "did:example:efgh#key",
                  "domain": "https://witness2.example.com/ledgers/spruce2021",
                  "jws": "eyJ..."
                }]                  
              }
            </pre>

            The anchor is embedded within an Activity during propagation flows.
            The Activity includes information about the CAS.

            <pre class="example highlight" title="Anchor as an AnchorCredential wrapped in a Create Activity">
              {
                "@context": [
                  "https://www.w3.org/ns/activitystreams",
                  "https://w3id.org/activityanchors/v1"
                ],
                "id": "https://sally.example.com/services/anchor/activities/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                "type": "Create",
                "actor": "https://sally.example.com/services/anchor",
                "to": [
                  "https://sally.example.com/services/anchor/followers",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "published": "2021-01-27T09:30:10Z",
                "target": {
                  "id":  "https://sally.example.com/cas/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                  "type": "ContentAddressedStorage",
                  "cid":  "bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y"
                },
                "object": {
                  "@context": [
                    "https://www.w3.org/2018/credentials/v1",
                    "https://www.w3.org/ns/activitystreams",
                    "https://w3id.org/activityanchors/v1"
                  ],
                  "id": "http://sally.example.com/anchors/642bab75-76a4-4b5f-98bb-794467ad5891",
                  "type": [
                    "VerifiableCredential",
                    "AnchorCredential"
                  ],
                  "issuer": "https://sally.example.com/services/anchor",
                  "issuanceDate": "2021-01-27T09:30:10Z",
                  "credentialSubject": {
                    "type": "AnchorEvent"
                  },
                  "proof": [{}]
                }
              }
            </pre>

          </section>

        </section>

        <section class="normative">
          <h3>ActivityPub</h3>

          <p>This section defines a minimal profile of [[ACTIVITYPUB]] that Activity Anchor Servers implement to participate in propagation flows.</p>

          <section class="normative">
            <h4>Actor (Discovery)</h4>
  
            <p>
              An <i>Actor</i> exposed by an Activity Anchor Server is capable of participating in propagation flows.
              ActivityPub endpoints are retrieved by performing an HTTP GET to the Actor endpoint.
              The Actor endpoint returns an <a href="https://www.w3.org/TR/activitypub/#actor-objects">Actor object</a>.
            </p>

            <pre class="example highlight" title="Actor retrieval">
              GET /services/anchor HTTP/1.1
              Host: alice.example.com
              Accept: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate
            </pre>

            <p>
              When the service profile exists, an HTTP 200 status code is returned.
            </p>

            <pre class="example highlight" title="Successful Actor response">
              HTTP/1.1 200 OK
              Date: Wed, 27 Jan 2021 21:57:25 GMT
              Content-Type: application/jrd+json; charset=utf-8
              Connection: keep-alive
              Access-Control-Allow-Origin: *

              {
                "@context": [
                "https://www.w3.org/ns/activitystreams",
                "https://w3id.org/security/v1",
                "https://w3id.org/activityanchors/v1"
                ],
                "id": "https://alice.example.com/services/anchor",
                "type": "Service",
                "publicKey": {
                  "id": "https://alice.example.com/services/anchor#main-key",
                  "owner": "https://alice.example.com/services/anchor",
                  "publicKeyPem": "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhki....."
                },
                "inbox": "https://alice.example.com/services/anchor/inbox",
                "outbox": "https://alice.example.com/services/anchor/outbox",
                "followers": "https://alice.example.com/services/anchor/followers",
                "following": "https://alice.example.com/services/anchor/following",
                "witnesses": "https://alice.example.com/services/anchor/witnesses",
                "witnessing": "https://alice.example.com/services/anchor/witnessing",
                "likes": "https://alice.example.com/services/anchor/likes",
                "liked": "https://alice.example.com/services/anchor/liked",
                "shares": "https://alice.example.com/services/anchor/shares"
              }
            </pre>

            <p class="issue" title="DID for service">
              TODO: Review handling of publicKey.
            </p>

          </section>

          <section class="normative">
            <h4>Delivery</h4>

            <p>
              Activity Anchor Servers use ActivityPub <a href="https://www.w3.org/TR/activitypub/#delivery">Delivery</a> mechanisms to propagate anchor activitys and to request to follow other servers.
              A propagation or follow request is sent by performing an HTTP POST of an activity to an Activity Anchor Server's ActivityPub inbox endpoint.
            </p>

            <p>
              Activity Anchor Servers use HTTP Signatures [[HTTP-SIGNATURES]] when calling Server-to-Server APIs to create authenticated messages.
              The anchor objects are additionally signed using JSON-LD proofs [[LDPROOF]] from both the Writer server as well as Witness servers.
            </p>
          </section>

          <section class="normative">
            <h4>Collections</h3>

            <p>
              Please refer to [[ACTIVITYPUB]] <a href="https://www.w3.org/TR/activitypub/#collections">section 5</a> for general collections guidance.
              An Activity Anchor Server exposes:
            </p>

            <ul>
              <li>Outbox: provides an ordered collection of the activities published by the server.</li>
              <li>Inbox: provides an ordered collection of the activities received by the server.</li>
              <li>Followers: provides a collection (or ordered collection) of the other Activity Anchor Servers following the server.</li>
              <li>Following: provides a collection (or ordered collection) of the other Activity Anchor Servers the server is following.</li>
              <li>Witnesses: provides a collection (or ordered collection) of the other Activity Anchor Servers that act as witnesses.</li>
              <li>Witnessing: provides a collection (or ordered collection) of the other Activity Anchor Servers the server is witnessing.</li>
              <li>Likes: provides an ordered collection of the processed and replicated anchor activities sent by an Activity Anchor Server.</li>
              <li>Liked: provides an ordered collection of the anchor activities processed and replicated by the Activity Anchor Server.</li>
              <li>Shares: provides an ordered collection of the propagation (announce) activities sent by the Activity Anchor Server.</li>
            </ul>
          </section>
  
          <section class="normative">
            <h4>Create Activity</h4>
            <p>
              An Activity Anchor Server that creates a anchor activity uses an <i>Create</i> activity to propagate that knowledge to its own followers.
              A anchor activity is propagated to another Activity Anchor Server by performing an HTTP POST of an <i>Create</i> activity containing an <i>AnchorCredential</i> to its ActivityPub inbox endpoint.
            </p>

            <pre class="example highlight" title="Propagating a new anchor activity (without an embedded anchor credential)">
              POST /services/anchor/inbox HTTP/1.1
              Host: alice.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": [
                  "https://www.w3.org/ns/activitystreams",
                  "https://w3id.org/activityanchors/v1"
                ],
                "id": "https://sally.example.com/services/anchor/activities/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                "type": "Create",
                "actor": "https://sally.example.com/services/anchor",
                "to": [
                  "https://sally.example.com/services/anchor/followers",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "published": "2021-01-27T09:30:10Z",
                "object": {
                  "id": "http://sally.example.com/anchors/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                  "type": "AnchorCredentialReference",
                  "target": {
                    "id":  "https://sally.example.com/cas/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                    "type": "ContentAddressedStorage",
                    "cid":  "bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y"
                  }
                }
              }
            </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>

            <pre class="example highlight" title="Propagating a new anchor activity (with an embedded anchor credential)">
              POST /services/anchor/inbox HTTP/1.1
              Host: alice.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": [
                  "https://www.w3.org/ns/activitystreams",
                  "https://w3id.org/activityanchors/v1"
                ],
                "id": "https://sally.example.com/services/anchor/activities/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                "type": "Create",
                "actor": "https://sally.example.com/services/anchor",
                "to": [
                  "https://sally.example.com/services/anchor/followers",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "published": "2021-01-27T09:30:10Z",
                "target": {
                  "id":  "https://sally.example.com/cas/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                  "type": "ContentAddressedStorage",
                  "cid":  "bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y"
                },
                "object": {
                  "@context": [
                    "https://www.w3.org/2018/credentials/v1",
                    "https://www.w3.org/ns/activitystreams",
                    "https://w3id.org/activityanchors/v1"
                  ],
                  "id": "http://sally.example.com/anchors/bafkreihwsnuregceqh263vgdathcprnbvatyat6h6mu7ipjhhodcdbyhoy",
                  "type": [
                    "VerifiableCredential",
                    "AnchorCredential"
                  ],
                  "issuer": "https://sally.example.com/services/anchor",
                  "issuanceDate": "2021-01-27T09:30:10Z",
                  "credentialSubject": {
                    "type": "AnchorEvent"
                  },
                  "proof": [{}]
                }
              }
            </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>            
          </section>
  
          <section class="normative">
            <h4>Announce Activity</h4>
            <p>
              An Activity Anchor Server that learns about a new anchor activity that was created by another Activity Anchor Server uses an <i>Announce</i> activity to gossip that knowledge to its own followers.
              A anchor activity is forwarded to another Activity Anchor Server by performing an HTTP POST of an <i>Announce</i> activity containing an <i>AnchorCredential</i> to its ActivityPub inbox endpoint.
            </p>

            <pre class="example highlight" title="Propagating a forwarded anchor activity (without an embedded anchor credential)">
              POST /services/anchor/inbox HTTP/1.1
              Host: alice.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": [
                  "https://www.w3.org/ns/activitystreams"
                ],
                "id": "https://sally.example.com/services/anchor/activities/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                "type": "Announce",
                "actor": "https://sally.example.com/services/anchor",
                "to": [
                  "https://sally.example.com/services/anchor/followers",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "published": "2021-01-27T09:30:10Z",
                "object": {
                  "type": "Collection",
                  "totalItems": 1,
                  "items": [
                    {
                      "@context": [
                        "https://w3id.org/activityanchors/v1"
                      ],
                      "id": "http://sally.example.com/anchors/bafkreihwsnuregceqh263vgdathcprnbvatyat6h6mu7ipjhhodcdbyhoy",
                      "type": "AnchorCredentialReference",
                      "target": {
                        "id":  "https://sally.example.com/cas/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                        "type": "ContentAddressedStorage",
                        "cid":  "bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y"
                      }
                    }
                  ]
                }
              }
            </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>

            <pre class="example highlight" title="Propagating a forwarded anchor activity (with an embedded anchor credential)">
              POST /services/anchor/inbox HTTP/1.1
              Host: alice.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": [
                  "https://www.w3.org/ns/activitystreams",
                  "https://w3id.org/activityanchors/v1"
                ],
                "id": "https://sally.example.com/services/anchor/activities/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                "type": "Announce",
                "actor": "https://sally.example.com/services/anchor",
                "to": [
                  "https://sally.example.com/services/anchor/followers",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "published": "2021-01-27T09:30:10Z",
                "object": {
                  "type": "Collection",
                  "totalItems": 1,
                  "items": [
                    {
                      "id": "http://sally.example.com/anchors/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                      "type": "AnchorCredentialReference",
                      "target": {
                        "id":  "https://sally.example.com/cas/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                        "type": "ContentAddressedStorage",
                        "cid":  "bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y"
                      },
                      "object": {
                        "@context": [
                          "https://www.w3.org/2018/credentials/v1",
                          "https://www.w3.org/ns/activitystreams",
                          "https://w3id.org/activityanchors/v1"
                        ],
                        "id": "http://sally.example.com/anchors/bafkreihwsnuregceqh263vgdathcprnbvatyat6h6mu7ipjhhodcdbyhoy",
                        "type": [
                          "VerifiableCredential",
                          "AnchorCredential"
                        ],
                        "issuer": "https://sally.example.com/services/anchor",
                        "issuanceDate": "2021-01-27T09:30:10Z",
                        "credentialSubject": {
                          "type": "AnchorEvent"
                        },
                        "proof": [{}]
                      }
                    }
                  ]
                }
              }
            </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>
          </section>

          <section class="normative">
            <h4>Follow Activity</h4>
              <p>
                An Activity Anchor Server requests to follow another Activity Anchor Server by performing an HTTP POST of a <i>Follow</i> activity to its ActivityPub inbox endpoint.
                Refer to <a href="https://www.w3.org/TR/activitypub/#follow-activity-inbox">ActivityPub</a> for guidance. 
              </p>

              <pre class="example highlight" title="Request to follow an Activity Anchor Server">
                POST /services/anchor/inbox HTTP/1.1
                Host: alice.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate
  
                {
                  "@context": "https://www.w3.org/ns/activitystreams",
                  "id": "https://sally.example.com/activities/9052018f-9530-4aef-8a46-40bde9445a25",
                  "type": "Follow",
                  "to": "https://alice.example.com/services/anchor",
                  "actor": "https://sally.example.com/services/anchor"
                }
              </pre>

              <p>
                On success, HTTP status code 200 is returned.
              </p>
          </section>

          <section class="normative">
            <h4>Accept Follow Activity</h4>
              <p>
                An Activity Anchor Server accepts a Follow request by sending an HTTP POST of a <i>Accept</i> activity to the requesting Activity Anchor Server's ActivityPub inbox endpoint.
                Refer to <a href="https://www.w3.org/TR/activitypub/#accept-activity-inbox">ActivityPub</a> for guidance. 
              </p>

              <pre class="example highlight" title="Accept follow request from an Activity Anchor Server">
                POST /services/anchor/inbox HTTP/1.1
                Host: sally.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate
  
                {
                  "@context": "https://www.w3.org/ns/activitystreams",
                  "id": "https://alice.example.com/activities/e017e49a-6256-44a0-855d-5dc304ae67f7",
                  "to": "https://sally.example.com/services/anchor",
                  "type": "Accept",
                  "actor": "https://alice.example.com/services/anchor",
                  "object": {
                      "id": "https://sally.example.com/activities/9052018f-9530-4aef-8a46-40bde9445a25",
                      "to": "https://alice.example.com/services/anchor",
                      "type": "Follow",
                      "actor": "https://sally.example.com/services/anchor",
                  }                  
                }
              </pre>

              <p>
                On success, HTTP status code 200 is returned.
              </p>  
          </section>

          <section class="normative">
            <h4>Reject Follow Activity</h4>
              <p>
                An Activity Anchor Server rejects a Follow request by sending an HTTP POST of a <i>Reject</i> activity to the requesting Activity Anchor Server's ActivityPub inbox endpoint.
                Refer to <a href="https://www.w3.org/TR/activitypub/#reject-activity-inbox">ActivityPub</a> for guidance. 
              </p>

              <pre class="example highlight" title="Reject follow request from an Activity Anchor Server">
                POST /services/anchor/inbox HTTP/1.1
                Host: sally.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate
  
                {
                  "@context": "https://www.w3.org/ns/activitystreams",
                  "id": "https://alice.example.com/activities/e017e49a-6256-44a0-855d-5dc304ae67f7",
                  "to": "https://sally.example.com/services/anchor",
                  "type": "Reject",
                  "actor": "https://alice.example.com/services/anchor",
                  "object": {
                      "id": "https://sally.example.com/activities/9052018f-9530-4aef-8a46-40bde9445a25",
                      "to": "https://alice.example.com/services/anchor",
                      "type": "Follow",
                      "actor": "https://sally.example.com/services/anchor",
                  }                  
                }
              </pre>

              <p>
                On success, HTTP status code 200 is returned.
              </p>  
          </section>

          <section class="normative">
            <h4>Like Activity</h4>
  
            <p class="issue" title="Acknowledgement">
              Discuss usage of Like as an acknowledgement.
            </p>
          
          </section>
  
        </section>

        <section class="normative" id='witness-activitypub'>
          <h3>Witness ActivityPub</h3>

          <section class="normative">
            <h4>Invite Witness Activity</h4>
            <p>
              An Activity Anchor Server invites another Activity Anchor Server to be a witness by performing an HTTP POST of an <i>Invite</i> activity containing an <i>AnchorWitness</i> target to its ActivityPub inbox endpoint.
            </p>

            <pre class="example highlight" title="Request to invite an Activity Anchor Server to be a witness">
                POST /services/anchor/inbox HTTP/1.1
                Host: alice.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate

                {
                  "@context": [
                    "https://www.w3.org/ns/activitystreams",
                    "https://w3id.org/activityanchors/v1"
                  ],
                  "id": "https://sally.example.com/activities/7052018f-9530-3aef-8a46-20bde9445a21",
                  "to": "https://alice.example.com/services/anchor",
                  "type": "Invite",
                  "actor": "https://sally.example.com/services/anchor",
                  "target": {
                    "type": "AnchorWitness",
                    "id": "https://alice.example.com/services/anchor"
                  }
                }
              </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>
          </section>

          <section class="normative">
            <h4>Accept Invite Witness Activity</h4>
            <p>
              An Activity Anchor Server accepts an Invite Witness request by sending an HTTP POST of a <i>Accept</i> activity to the requesting Activity Anchor Server's ActivityPub inbox endpoint.
              Upon receiving this activity, the requesting Activity Anchor Server adds the actor to its collection of 'witnesses'.
              Refer to <a href="https://www.w3.org/TR/activitypub/#accept-activity-inbox">ActivityPub</a> for guidance.
            </p>

            <pre class="example highlight" title="Accept invite witness request from an Activity Anchor Server">
                POST /services/anchor/inbox HTTP/1.1
                Host: sally.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate

                {
                  "@context": [
                    "https://www.w3.org/ns/activitystreams",
                    "https://w3id.org/activityanchors/v1"
                  ],
                  "id": "https://alice.example.com/activities/f017e49a-7256-44a0-255d-3dc304ae67f7",
                  "to": "https://sally.example.com/services/anchor",
                  "type": "Accept",
                  "actor": "https://alice.example.com/services/anchor",
                  "object": {
                      "id": "https://sally.example.com/activities/7052018f-9530-3aef-8a46-20bde9445a21",
                      "to": "https://alice.example.com/services/anchor",
                      "type": "Invite",
                      "actor": "https://sally.example.com/services/anchor",
                      "target": {
                        "type": "AnchorWitness",
                        "id": "https://alice.example.com/services/anchor"
                      }
                  }
                }
              </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>
          </section>

          <section class="normative">
            <h4>Reject InviteWitness Activity</h4>
            <p>
              An Activity Anchor Server rejects an Invite Witness request by sending an HTTP POST of a <i>Reject</i> activity to the requesting Activity Anchor Server's ActivityPub inbox endpoint.
              Refer to <a href="https://www.w3.org/TR/activitypub/#reject-activity-inbox">ActivityPub</a> for guidance.
            </p>

            <pre class="example highlight" title="Reject invite witness request from an Activity Anchor Server">
                POST /services/anchor/inbox HTTP/1.1
                Host: sally.example.com
                Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
                Accept-Encoding: gzip, deflate

                {
                  "@context": [
                    "https://www.w3.org/ns/activitystreams",
                    "https://w3id.org/activityanchors/v1"
                  ],
                  "id": "https://alice.example.com/activities/b013e49a-6256-24a0-855d-1dc304ar67f7",
                  "to": "https://sally.example.com/services/anchor",
                  "type": "Reject",
                  "actor": "https://alice.example.com/services/anchor",
                  "object": {
                      "id": "https://sally.example.com/activities/7052018f-9530-3aef-8a46-20bde9445a21",
                      "to": "https://alice.example.com/services/anchor",
                      "type": "Invite",
                      "actor": "https://sally.example.com/services/anchor",
                      "target": {
                        "type": "AnchorWitness",
                        "id": "https://alice.example.com/services/anchor"
                      }
                  }
                }
              </pre>

            <p>
              On success, HTTP status code 200 is returned.
            </p>
          </section>

          <section class="normative">
            <h4>Offer Activity</h4>

            <p>
              An Activity Anchor Server sends a <i>preannouncement</i> of an anchor using an <i>Offer</i> activity populated with an <i>AnchorCredential</i>.
              The <i>AnchorCredential</i> contains a Linked Data Proof from the activity server.
              The <i>Offer</i> activity also includes a <i>startTime</i> and <i>endTime</i> indicating the time period where the Activity Anchor Server will accept
              linked data proofs for inclusion into the anchor activity.
              The <i>startTime</i> is the current timestamp for the Activity Anchor Server.
              The <i>endTime</i> is the cut-off timestamp for inclusion into the activity.
            </p>

            <pre class="example highlight" title="Propagating a new anchor activity (with an embedded anchor credential)">
              POST /services/anchor/inbox HTTP/1.1
              Host: witness1.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": [
                  "https://www.w3.org/ns/activitystreams"
                ],
                "id": "https://sally.example.com/services/anchor/activities/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
                "type": "Offer",
                "actor": "https://sally.example.com/services/anchor",
                "to": [
                  "https://sally.example.com/services/anchor/witnesses",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "target": {
                  "type": "AnchorWitness"
                }
                "startTime": "2021-01-27T09:30:10Z",
                "endTime": "2021-01-27T09:31:10Z",
                "object": {
                  "@context": [
                    "https://www.w3.org/2018/credentials/v1",
                    "https://www.w3.org/ns/activitystreams",
                    "https://w3id.org/activityanchors/v1"
                  ],
                  "id": "http://sally.example.com/anchors/ed7c2d19-be27-44d4-b393-d3ec9775a1d1",
                  "type": [
                    "VerifiableCredential",
                    "AnchorCredential"
                  ],
                  "issuer": "https://sally.example.com/services/anchor",
                  "issuanceDate": "2021-01-27T09:30:10Z",
                  "credentialSubject": {
                    "type": "AnchorEvent"
                  },
                  "proof": {}
                }
              }
            </pre>
          </section>

          <section class="normative">
            <h4>Accept Anchor Activity</h4>

            <p>
              A Witness promises to include an anchor activity into their ledger using a <i>Accept</i> activity populated with its linked data proof
              of an <i>AnchorCredential</i> received in a previous <i>Offer</i>.
              A reference to the previously offered object is populated into the <i>object</i> field.
              The Witness includes the time range when the anchor activity will become included into their ledger using <i>startTime</i> and <i>endTime</i> fields.
            </p>

            <pre class="example highlight" title="Providing a Linked Data Proof as a witness">
              POST /services/anchor/inbox HTTP/1.1
              Host: witness1.example.com
              Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"
              Accept-Encoding: gzip, deflate

              {
                "@context": [
                  "https://www.w3.org/ns/activitystreams",
                  "https://w3id.org/activityanchors/v1"
                ],
                "id": "https://witness1.example.com/services/anchor/activities/87bcd005-abb6-433d-a889-18bc1ce84988",
                "type": "Accept",
                "actor": "https://witness1.example.com/services/anchor",
                "to": [
                  "https://sally.example.com/services/anchor",
                  "https://www.w3.org/ns/activitystreams#Public"
                ],
                "object": {
                  "id": "https://sally.example.com/services/anchor/activities/9052018f-9530-4aef-8a46-40bde9445a25",
                  "to": "https://witness1.example.com/services/anchor",
                  "type": "Offer",
                  "actor": "https://sally.example.com/services/anchor",
                  "target": {
                    "type": "AnchorWitness"
                  }  
                },
                "result": {
                    "type": "AnchorReceipt",
                    "inReplyTo": "http://sally.example.com/anchors/ed7c2d19-be27-44d4-b393-d3ec9775a1d1",
                    "startTime": "2021-01-27T09:30:15Z",
                    "endTime": "2021-01-27T09:40:15Z",
                    "attachment": [{
                      "@context": [
                          "https://w3id.org/activityanchors/v1",
                          "https://w3id.org/jws/v1"
                      ],    
                      "type": "AnchorProof",
                      "proof": {
                          "type": "JsonWebSignature2020",
                          "proofPurpose": "assertionMethod",
                          "created": "2021-01-27T09:30:15Z",
                          "verificationMethod": "did:example:abcd#key",
                          "domain": "https://witness1.example.com/ledgers/maple2021",
                          "jws": "eyJ..."  
                        }
                    }]
                }
              }
            </pre>

            <p>
              The Writer Activity Anchor Server assembles the linked data proofs into a proof chain to create the final <i>AnchorCredential</i>.
              The proof chain starts with the Writer's linked data proof followed by each witness's linked data proof.
              See <a href="#anchorcredential"></a>.
            </p>

            <p class="issue" title="Log-specific attachments">
              Determine if it makes sense to also include log-specific attachments such as signed certificate timestamps.
            </p>
          </section>

          <section class="normative">
            <h4>Reject Anchor Activity</h4>

            <p class="issue" title="Provide description">
              TODO: Provide description and example for Reject.
            </p>
          </section>

        </section>

        <section class="normative">
          <h3>WebFinger</h3>

          <p>
            WebFinger [[RFC7033]] is used to discover endpoints for anchor service and resource URIs.
          </p>

          <p>The following example retrieves endpoints for a service named anchor at alice.example.com.</p>

          <pre class="example highlight" title="Discover endpoints for an Anchor service (request).">
            GET /.well-known/webfinger?resource=https%3A%2F%2Falice.example.com%2Fservices%2Fanchor HTTP/1.1
            Host: alice.example.com
            Accept-Encoding: gzip, deflate
          </pre>

          <p>
            When the resource exists, an HTTP 200 status code is returned.
          </p>

          <pre class="example highlight" title="Discover endpoints for an Anchor service (response).">
            HTTP/1.1 200 OK
            Date: Sat, 30 Jan 2021 13:20:11 GMT
            Content-Type: application/jrd+json
            Connection: keep-alive
            Access-Control-Allow-Origin: *

            {
              "subject": "https://alice.example.com/services/anchor",
              "aliases": [
                "https://alice.example.com/@anchor",
                "https://alice.example.com/services/anchor"
              ],
              "links": [
                {
                  "rel": "self",
                  "type": "application/activity+json",
                  "href": "https://alice.example.com/services/anchor"
                }
              ]
            }
          </pre>

          <p>
            Aliases for a resource can also be queried. For example, the following is a request for anchor@alice.example.com.
            This request has the same response as the prior example.
          </p>

          <pre class="example highlight" title="Discover endpoints for an Anchor service using service alias.">
            GET /.well-known/webfinger?resource=acct%anchor%40alice.example.com HTTP/1.1
            Host: alice.example.com
            Accept-Encoding: gzip, deflate
          </pre>

          <p>
            WebFinger is also used to query for resource endpoint discovery.
          </p>

          <pre class="example highlight" title="Discover endpoints for an anchor service (request).">
            GET /.well-known/webfinger?resource=https%3A%2F%2Fsally.example.com%2Fanchor activitys%2Fbafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y HTTP/1.1
            Host: sally.example.com
            Accept-Encoding: gzip, deflate
          </pre>

          <p>
            When the resource exists, an HTTP 200 status code is returned.
          </p>

          <pre class="example highlight" title="Discover endpoints for an anchor service (response).">
            HTTP/1.1 200 OK
            Date: Sat, 30 Jan 2021 13:20:11 GMT
            Content-Type: application/jrd+json
            Connection: keep-alive
            Access-Control-Allow-Origin: *

            {
              "subject": "https://sally.example.com/anchors/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y",
              "links": [
                {
                  "rel": "self",
                  "type": "application/ld+json",
                  "href": "https://sally.example.com/anchors/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y"
                },
                {
                  "rel": "working-copy",
                  "type": "application/ld+json",
                  "href": "https://sally.example.com/cas/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y"
                },
                {
                  "rel": "working-copy",
                  "type": "application/ld+json",
                  "href": "https://replica.example.com/cas/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y"
                }
              ]
            }
          </pre>

          <p class="issue" title="Link relations">
            Review the appropriate link relations in the above example.
          </p>

        </section>

        <section class="normative">
          <h3>Content Addressable Storage</h3>

          <p>
            Activity Anchor Servers expose anchor content as content-addressable objects.
            These objects can be retrieved through Web endpoints or discovered using a Distributed Hash Table (DHT).
          </p>

          <section class="normative">
            <h4>WebCAS</h4>
            <p>
              Activity Anchor Servers expose a CAS endpoint to provide access to anchor content.
              Resources are retrieved by sending a HTTP GET to the Server's CAS path with the content identifier [[CID]] of the resource.
            </p>

            <pre class="example highlight" title="Retrieve content from WebCAS (request).">
              GET /cas/bafkreiatkubvbkdidscmqynkyls3iqawdqvthi7e6mbky2amuw3inxsi3y HTTP/1.1
              Host: sally.example.com
              Accept-Encoding: gzip, deflate
            </pre>

            <p>
              When the content exists, an HTTP 200 status code is returned.
            </p>

            <pre class="example highlight" title="Retrieve content from WebCAS (response).">
              HTTP/1.1 200 OK
              Date: Sat, 30 Jan 2021 13:20:11 GMT
              Content-Type: text/plain; charset=utf-8
              Connection: keep-alive
              Access-Control-Allow-Origin: *

              {
                "@context": [
                  "https://www.w3.org/2018/credentials/v1",
                  "https://www.w3.org/ns/activitystreams",
                  "https://w3id.org/activityanchors/v1",
                  "https://w3id.org/jws/v1"
                ],
                "id": "http://sally.example.com/anchors/bafkreihwsnuregceqh263vgdathcprnbvatyat6h6mu7ipjhhodcdbyhoy",
                "type": [
                  "VerifiableCredential",
                  "AnchorCredential"
                ],
                "issuer": "https://sally.example.com/services/anchor",
                "issuanceDate": "2021-01-27T09:30:10Z",
                "credentialSubject": {
                  "type": "AnchorEvent"
                },
                "proof": [{}]                  
              }
            </pre>
          </section>

          <section class="normative">
            <h4>Distributed Hash Table</h4>
  
            <p class="issue" title="An Activity Anchor DHT profile may be considered in the future">
              We currently enable usage of the IPFS DHT.
              In the future, we may want to additionally consider a more specific profile to limit usage to VDRs.
            </p>
          </section>
  
        </section>

    </section>

    <section id='conformance'>
      <!-- This section is filled automatically by ReSpec. -->
    </section>
  </body>
</html>